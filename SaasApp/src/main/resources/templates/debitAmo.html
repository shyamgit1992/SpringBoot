<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Debit Customer Amount</title>
<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script> -->

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.6/ui-bootstrap.js" type="text/javascript"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.5/angular.min.js"></script>
<script src="http://code.angularjs.org/1.2.0rc1/angular-route.js"></script> -->
 <!-- Angular Scripts -->
 <!--  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.min.js"></script>
<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-aria.min.js"></script>
<script src = "https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-messages.min.js"></script>
<script src = "https://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.js"></script> -->

 <!-- JS Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.6/ui-bootstrap.js" type="text/javascript"></script>

  <!-- Angular Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>
<body data-ng-app="invoice" >
<div class="container">
<input type="button" value="Back To Bill"
			th:onclick="'window.location.href = \'' + @{/cust/customersBillss/{id}(id=${ct.id})} + '\''"
				class="btn btn-primary" />
<input type="button" value="Back To Customers"
			th:onclick="'window.location.href = \'' + @{/cust/customers} + '\''"
				class="btn btn-primary" />				
				<br><hr>
<div class="row">

    <div class="col-md-12" data-ng-controller="InvoiceController">

        <form name="myForm">

            <div class="row">
                <div class="col-md-offset-2 col-md-8">
                    <div class="card">
                    <a hidden id="ids"><span th:text="${ct.id}"></span></a>
                    <a hidden id="fullName"><span th:text="${ct.fullName}"></span></a>
                        <div class="card-header bg-primary text-white">
                            Debit Customer Amount
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="name">Full Name</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" data-ng-model="fullName" disabled>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="name">Debit Amount <span class="requerido"> *</span></label>
                                <div class="col-sm-8">
                                    <input type="number" class="form-control" data-ng-model="debitAmount" placeholder="Debit Amount" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="name">Rate of Interest (%) <span class="requerido"> *</span></label>
                                <div class="col-sm-8">
                                    <input type="number" class="form-control" data-ng-model="debitInt" placeholder="Rate of Interest" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="rut">Status<span class="requerido"> *</span></label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" data-ng-model="status" placeholder="Status" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="col-sm-4 control-label" for="rut">Note</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" data-ng-model="note" placeholder="Any Note">
                                </div>
                            </div>
                            
                            <hr>
                            <div class="form-group text-center">
                                <button type="submit" data-ng-click="Debit()" class="btn btn-success">Debit Amount</button>
                            </div>
                           
                        </div>
                    </div>
                </div>
            
            </div>
        </form> 
         <hr>
  
<div class="container-fluid">
		<div class="col-md-12" data-ng-controller="InvoiceController as list">
			<h2>Debit Amount List</h2>
			<hr />
            <div class="input-group">
				<input type="search" class="form-control"  ng-model="search.id" placeholder="Enter your search Id" />
			    <span class="input-group-addon">
                <span class="glyphicon glyphicon-search"></span> </span>
			</div>
			</br>
			
			<div><label>Total number of Debits : </label> <span th:text="${count_DebitAmo}"></span></div>	 
			<div class="card">
				<div class="card-header bg-primary text-white">
					Debit Amount List
				</div>
				<div class="card-body">
					<table class="table table-hover table-striped table-bordered">
						<tr>
							<th scope="col"><a href="" ng-click="columnToOrder='id';reverse=!reverse">Id</a></th>
							<th> Debit Amount </th>
							<th> Rate Of Interest(%)</th>
							<th> Due Days</th>
                            <th> Total Interest</th>
							<th> Status </th>
                            <th> Note </th>
                            <th> Debit Date/Time </th>
                            <th> Action </th>
						</tr>
                       <tr ng-repeat="i in db | orderBy:columnToOrder:forward">
                        <td>{{i.id}}</td>
                        <td>{{i.debitAmount | currency:"&#8377;"}}</td>
                        <td>{{i.debitInt}} %</td>
                        <td>{{i.dueDays}}</td>
                        <td>{{i.totalInterestAmount | currency:"&#8377;"}}</td>
                        <td>{{i.status}}</td>
                        <td>{{i.note}}</td>
                        <td>{{i.debitDate | date:'d/M/yyyy hh:mm:ss'}}</td>
                        <td>
                          <div style='display: inline-block;'><a type="button" href="/debitAmo/editDebitAmo/{{CustomerId}}/db/{{i.id}}" class="btn btn-success btn-sm rounded-0" ><i class="fa fa-edit"></i></a></div>
                          <div style='display: inline-block;'><a type="button" href="/debitAmo/deleteDebitAmo/{{CustomerId}}/db/{{i.id}}" class="btn btn-danger btn-sm rounded-0" ><i class="fa fa-trash"></i></a></div>
                       </td>
                      </tr>
					</table>
                
				</div>
			</div>
		</div>

	</div>
    </div>
</div>

</div>

</body>
<script type="text/javascript">
var invoice = angular.module('invoice', []);
invoice.controller('InvoiceController', function($scope,$window,$http,$timeout){
	$scope.fullName = document.getElementById("fullName").innerText;
	$scope.Debit = function(){
		if(!$scope.myForm.$valid){
			console.log("Invalid")
			$scope.err = "Invaid Transaction Please Insert valid field or Refresh!!!";
			}
		 if($scope.myForm.$valid){
		var id = document.getElementById("ids").innerText;
		if($scope.note == null){
 			$scope.note = "None";
 		}
		var data={
				"debitAmount" : $scope.debitAmount,
				"debitInt" : $scope.debitInt,
				"status" : $scope.status,
				"note" : $scope.note,
				};
		console.log("Data ::");
		console.log(data);
		$scope.CustomerId = id;
		var URL = "http://localhost:8083/debitAmo/AddDebitAmo/"+$scope.CustomerId+"";
		$http.post(URL, data); 
		$window.location.href = "/creditAmo/getCreditAmoView/"+$scope.CustomerId+"";
		$window.location.reload();
	}
	}
	var id = document.getElementById("ids").innerText;
	$scope.CustomerId = id;
	 $http.get("http://localhost:8083/debitAmo/getAmo/"+$scope.CustomerId+"").then(function(data, status, headers, config) {
		$scope.items = data.data;
		console.log($scope.items);
		$scope.totalint=null;
		var cur = null;
		var ex = null;
		var day = null;
		var IntRate = null;
		$scope.db = [];
		 angular.forEach($scope.items, function(value,key){
			 cur = new Date();
			 ex = new Date(value.debitDate);
			 day=(cur-ex)/ 1000 / 60 / 60 / 24;
			 $scope.days=(cur-ex)/ 1000 / 60 / 60 / 24;
			 IntRate = value.debitInt;
			 dAmo = value.debitAmount;
			 $scope.totalint = (((((dAmo * IntRate)/100)*day))/30);
             $scope.db.push({ 
            	 id : value.id,
            	 debitAmount  : value.debitAmount,
            	 debitInt: value.debitInt,
            	 dueDays: $scope.days.toFixed(2),
            	 totalInterestAmount :  $scope.totalint,
            	 status : value.status,
            	 note : value.note,
            	 debitDate : value.debitDate
            	 });
		 });
		}); 
});
</script>
</html>