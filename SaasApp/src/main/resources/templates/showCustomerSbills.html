<!DOCTYPE HTML>

<html  xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>Customer Sell Bill Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Kim Maida">

  <!-- JS Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.6/ui-bootstrap.js" type="text/javascript"></script>

  <!-- Angular Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />

</head>

<body ng-app="myApp" ng-controller="PageCtrl as list">
<div class="container-fluid">
<div align="center">
     <h1>Customer Sell Bill List</h1>
    <hr>
    <div class="col-md-6">
    <table class="table table-hover table-striped table-bordered">
    <thead class="thead-dark">
    <tr>
    <th>Customer Id</th>
    <th>Name</th>
    <th>Address</th>
    <th>Total Amount</th>
    <th>Total Paid Amount</th>
    <th>Total Due Amount</th>
    </tr>
    </thead>
    <tr>
    <td><span id="ids" th:text="${ct.id}"></span></td>
    <td><span th:text="${ct.fullName}"></span></td>
    <td><span th:text="${ct.address}"></span></td>
    <td><span>{{getTotalAmount() | currency:"&#8377;"}}</span></td>
    <td><span>{{getTotalPaidAmount() | currency:"&#8377;"}}</span></td>
    <td><span>{{getTotalDueAmount() | currency:"&#8377;"}}</span></td>
    </tr>
    </table>
    </div>
   
    
   
</div>    
   <hr>
		<div class="col-md-12">
			
			
            <!-- <div class="input-group">
				<input type="search" class="form-control"  ng-model="search.fullName" placeholder="Enter your search name" />
			    <span class="input-group-addon">
                <span class="glyphicon glyphicon-search"></span> </span>
			</div> -->
			</br>
			<input type="button" value="Add Sell Bills"
				th:onclick="'window.location.href = \'' + @{/Scust/customersSellBill/{id}(id=${ct.id})} + '\''"
				class="btn btn-primary" />
			<input type="button" value="Back To Customers"
			th:onclick="'window.location.href = \'' + @{/cust/customers} + '\''"
				class="btn btn-primary" />	
			<input type="button" value="Credit Amount"
			th:onclick="'window.location.href = \'' + @{/creditAmo/getCreditAmoView/{id}(id=${ct.id})} + '\''"
				class="btn btn-primary" />	
			<input type="button" value="Debit Amount"
			th:onclick="'window.location.href = \'' + @{/debitAmo/getDebitAmoView/{id}(id=${ct.id})} + '\''"
				class="btn btn-primary" />		
					
				<br/><br/>
			<div><label>Total number of Customers Sell Bill: </label> <span th:text="${count_CustomersSBill}"></span></div>	
			<div class="card">
				<div class="card-header bg-primary text-white">
					Customer Bills List
				</div>
				<div style="overflow-x:auto;" class="card-body ">
					<table class="table table-hover table-striped table-bordered">
					<tr>
					<th scope="col">Bill No.</th>
					<th scope="col">Status</th>
					<th scope="col">Note</th>
					<th scope="col">BillingDate</th>
					<th scope="col">Subtotal Amount</th>
					<th scope="col">Total GST</th>
					<th scope="col">Total Discount</th>
					<th scope="col">Total Amount</th>
					<th scope="col">Paid Amount</th>
					<th scope="col">Due Amount</th>
					<th>Action</th>
					</tr>
					<tr ng-repeat="c in items.sbill | orderBy:'id'">
					<td>{{c.id}}</td>
					<td>{{c.status}}</td>
					<td>{{c.note}}</td>
					<td>{{c.billingDate|date:'d/M/yyyy hh:mm:ss'}}</td>
					<td>{{c.subtotalAmount | currency:"&#8377;"}}</td>
					<td>{{c.totalGSTAmount | currency:"&#8377;"}}</td>
					<td>{{c.totalDiscountAmount | currency:"&#8377;"}}</td>
					<td>{{c.totalAmount | currency:"&#8377;"}}</td>
					<td>{{c.paidAmount | currency:"&#8377;"}}</td>
					<td>{{c.dueAmount | currency:"&#8377;"}}</td>
					<td>
                     <div style='display: inline-block;'><a type="button" href="/Scust/viewSellBill/{{CustomerId}}/sbill/{{c.id}}" class="btn btn-primary btn-sm rounded-0" ><i class="fa fa-user"></i></a></div>
                     <div style='display: inline-block;'><a type="button" href="/Scust/editSBill/{{CustomerId}}/sbill/{{c.id}}" class="btn btn-success btn-sm rounded-0" ><i class="fa fa-edit"></i></a></div>
                     <div style='display: inline-block;'><a type="button" href="/Scust/SBillDelete/{{CustomerId}}/sbill/{{c.id}}" class="btn btn-danger btn-sm rounded-0" ><i class="fa fa-trash"></i></a></div>
                     <div style='display: inline-block;'><a type="button" href="/Scust/printSBill/{{CustomerId}}/sbill/{{c.id}}" class="btn btn-danger btn-sm rounded-0" ><i class="fa fa-print"></i></a></div>
                    </td>
					</tr>
					</table>
                    
           
               
				</div>
			</div>
		</div>

	</div>
</body>
<script type="text/javascript">
var app = angular.module('myApp', ['ui.bootstrap']);

app.controller('PageCtrl', ['$scope', 'filterFilter', '$http', function ($scope, filterFilter, $http) {
	var id = document.getElementById("ids").innerText;
	$scope.CustomerId = id;
	//var custTotal = 0;
	$http.get("http://localhost:8083/cust/customers/"+$scope.CustomerId+"").then(function(data, status, headers, config) {
		$scope.items = data.data;
		console.log($scope.items);
		$scope.getTotalAmount = function(){
			  var total = 0;
			  angular.forEach($scope.items.sbill, function(value,key){
			    total += parseFloat(value.totalAmount);
			  })
			  return total;
			}
		$scope.getTotalPaidAmount = function(){
			  var total = 0;
			  angular.forEach($scope.items.sbill, function(value,key){
			    total += parseFloat(value.paidAmount);
			  })
			  return total;
			}
		$scope.getTotalDueAmount = function(){
			  var total = 0;
			  angular.forEach($scope.items.sbill, function(value,key){
			    total += parseFloat(value.dueAmount);
			  })
			  return total;
			}
		
		
	});
	//console.log(custTotal);
	/* var x = null;
	var id = document.getElementById("ids").innerText;
	$scope.CustomerId = id;
	 $http.get("http://localhost:8083/creditAmo/getAmo/"+$scope.CustomerId+"").then(function(data, status, headers, config) {
		$scope.itemsCredit = data.data;
		$scope.getTotalCreditAmount = function(){
			  var total = 0;
			  angular.forEach($scope.itemsCredit, function(value,key){
			    total += parseFloat(value.creditAmount);
			  });
			  return total;
			}
		 $scope.getCreditAmount($scope.getTotalCreditAmount());
		 
		});
	 $http.get("http://localhost:8083/debitAmo/getAmo/"+$scope.CustomerId+"").then(function(data, status, headers, config) {
		 $scope.itemsDebit = data.data;
		 $scope.getTotalDebitAmount = function(){
			  var total = 0;
			  angular.forEach($scope.itemsDebit, function(value,key){
			    total += parseFloat(value.debitAmount);
			  });
			  return total;
			},
		
		 $scope.getTotalInterestDebitAmount = function(){
		 $scope.totalint=null;
			var cur = null;
			var ex = null;
			var day = null;
			var IntRate = null;
			var total = 0;
			
			 angular.forEach($scope.itemsDebit, function(value,key){
				 cur = new Date();
				 ex = new Date(value.debitDate);
				 day=(cur-ex)/ 1000 / 60 / 60 / 24;
				 $scope.days=(cur-ex)/ 1000 / 60 / 60 / 24;
				 IntRate = value.debitInt;
				 dAmo = value.debitAmount;
				 $scope.totalint = (((((dAmo * IntRate)/100)*day))/30);
				 total += parseFloat($scope.totalint);
	             
			 });
			 return total;
		 },
		 $scope.getTotalDebitInterestWithAmount = function(){
			  var total = 0;
			  var d = 0;
			  var i = 0;
			  angular.forEach($scope.itemsDebit, function(value,key){
			    //console.log(value.totalInterestAmount);
			    d = $scope.getTotalDebitAmount();
			    i += parseFloat($scope.getTotalInterestDebitAmount());
			    total=d+i;
			  })
			 
			  return total;
			}
		 $scope.getDebitAmount($scope.getTotalDebitInterestWithAmount());
		 });  
	 $scope.getCreditAmount = function(x){
		 $scope.cr = x;
		 }
	 $scope.getDebitAmount = function(x){
		 $scope.dr = x;
		 }
	 $scope.getTotalIntAmount = function(x){
		 $scope.Int = x;
	 }
	 $scope.getTotalPayAmount = function(){
		return $scope.dr+$scope.Int;
	 }
	 $scope.getTotalPayOutAmount = function(){
			return  $scope.getTotalPayAmount()-$scope.cr;
	}
	 $scope.getPayOutStatus = function(){
		   if($scope.getTotalPayAmount()>$scope.cr){
			 var u = "Unpaid"; 
			 return u;
		 }
		 if($scope.getTotalPayAmount()==$scope.cr){
			 var p = "Paid"; 
			 return p;
		 } 
		 if($scope.getTotalPayAmount()<$scope.cr){
			 var o = "Over Paid"; 
			 return o;
		 } 
		
	} */
	  
	 
	 
}]);
</script>
</html>