<!DOCTYPE HTML>

<html  xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>Dealer Sell Bill Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Kim Maida">

  <!-- JS Libraries -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.6/ui-bootstrap.js" type="text/javascript"></script>

  <!-- Angular Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />

</head>

<body ng-app="myApp" ng-controller="PageCtrl as list">
<div class="container-fluid">
<div align="center">
    <h1>Dealer Sell Bill List</h1>
    <label>Id:</label><a><span id="ids" th:text="${ds.id}"></span></a></br>
    <label>Name:</label><a><span th:text="${ds.fullName}"></span></a></br>
    <label>Total Amount         :</label><a><span>{{getTotalAmount() | currency:"&#8377;"}}</span></a></br>
    <label>Total Paid Amount    :</label><a><span>{{getTotalPaidAmount() | currency:"&#8377;"}}</span></a></br>
    <label>Total Due Amount     :</label><a><span>{{getTotalDueAmount() | currency:"&#8377;"}}</span></a></br>
    <label>Total Credited Amount:</label><a><span>{{getTotalCreditAmount() | currency:"&#8377;"}}</span></a></br>
    <label>Total Final PayOut Amount:</label><a><span>{{getTotalPayOutAmount() | currency:"&#8377;"}}</span></a></br>
    <label>Pay Out Status:</label><a><span>{{getPayOutStatus()}}</span></a></br>
    <label>Total Cement Stock:</label><a><span>{{getTotalStock()}}</span></a></br>
    <label>Total Cement Avg. Price:</label><a><span>{{getTotalAvgPrice() | currency:"&#8377;"}}</span></a></br>
   
</div>    
   <hr>
		<div class="col-md-12">
			
			
            <!-- <div class="input-group">
				<input type="search" class="form-control"  ng-model="search.fullName" placeholder="Enter your search name" />
			    <span class="input-group-addon">
                <span class="glyphicon glyphicon-search"></span> </span>
			</div> -->
			</br>
			<input type="button" value="Add Firm Purchase Bills"
				th:onclick="'window.location.href = \'' + @{/firmSell/firmSellBill/{id}(id=${ds.id})} + '\''"
				class="btn btn-primary" />
			<input type="button" value="Back To Dealers"
			th:onclick="'window.location.href = \'' + @{/deal/dealers} + '\''"
				class="btn btn-primary" />	
			<input type="button" value="Credit To Dealer Amount"
			th:onclick="'window.location.href = \'' + @{/creditDealerAmo/getCreditDealerAmoView/{id}(id=${ds.id})} + '\''"
				class="btn btn-primary" />	
			<input type="button" value="Show Products"
			th:onclick="'window.location.href = \'' + @{/pro/showProducts} + '\''"
				class="btn btn-primary" />	
			
				<br/><br/>
			<input type="button" value="Show Taxes"
			th:onclick="'window.location.href = \'' + @{/tax/showTaxes} + '\''"
				class="btn btn-primary" />	
			
				<br/><br/>	
			<div><label>Total number of Dealer Sell Bill: </label> <span th:text="${count_DealerBill}"></span></div>	
			<div class="panel panel-info">
				<div class="panel-heading">
					<div class="panel-title">Dealer Purchase Bills List</div>
				</div>
				<div style="overflow-x:auto;" class="panel-body ">
					<table class="table table-hover table-striped table-bordered">
					<tr>
					<th scope="col">Bill No.</th>
					<th scope="col">Status</th>
					<th scope="col">Note</th>
					<th scope="col">Total Items</th>
					<th scope="col">Total Weight</th>
					<th scope="col">Total Weight Cut</th>
					<th scope="col">Total Net Weight</th>
					<th scope="col">Subtotal Amount</th>
					<th scope="col">Total Cut Amount</th>
					<th scope="col">Other Cut Amount</th>
					<th scope="col">Total Brokerage</th>
					<th scope="col">Total Fare</th>
					<th scope="col">Total Amount</th>
					<th scope="col">Paid Amount</th>
					<th scope="col">Due Amount</th>
					<th scope="col">BillingDate</th>
					<th>Action</th>
					</tr>
					<tr ng-repeat="d in items.firmSellBill | orderBy:'id'">
					<td>{{d.id}}</td>
					<td>{{d.status}}</td>
					<td>{{d.note}}</td>
					<td>{{d.totalItemno}} Nos</td>
					<td>{{d.totalWeight}} Kg</td>
					<td>{{d.totalCut}} Kg</td>
					<td>{{d.totalNetWeight}} Kg</td>
					<td>{{d.subTotalAmount | currency:"&#8377;"}}</td>
					<td>{{d.totalCutAmo | currency:"&#8377;"}}</td>
					<td>{{d.totalOtherCut | currency:"&#8377;"}}</td>
	                <td>{{d.brokerage | currency:"&#8377;"}}</td>
					<td>{{d.fare | currency:"&#8377;"}}</td>
					<td>{{d.totalAmount | currency:"&#8377;"}}</td>
					<td>{{d.paidAmount | currency:"&#8377;"}}</td>
					<td>{{d.dueAmount | currency:"&#8377;"}}</td>
					<td>{{d.billingDate|date:'d/M/yyyy hh:mm:ss'}}</td>
					<td>
					 <a class="btn btn-primary btn-sm rounded-0" href="/firmSell/accStatePaid/{{DealerId}}/bill/{{d.id}}/Paid">Paid</a>
                     <div style='display: inline-block;'><a type="button" href="/firmSell/viewFirmBill/{{DealerId}}/bill/{{d.id}}" class="btn btn-primary btn-sm rounded-0" ><i class="fa fa-user"></i></a></div>
                     <div style='display: inline-block;'><a type="button" href="/firmSell/editFirmBill/{{DealerId}}/bill/{{d.id}}" class="btn btn-success btn-sm rounded-0" ><i class="fa fa-edit"></i></a></div>
                     <div style='display: inline-block;'><a type="button" href="/firmSell/deleteFirmBill/{{DealerId}}/bill/{{d.id}}" class="btn btn-danger btn-sm rounded-0" ><i class="fa fa-trash"></i></a></div>
                     <div style='display: inline-block;'><a type="button" href="/firmSell/printFirmBill/{{DealerId}}/bill/{{d.id}}" class="btn btn-danger btn-sm rounded-0" ><i class="fa fa-print"></i></a></div>
                    </td>
					</tr>
					</table>
                    
           
               
				</div>
			</div>
		</div>

	</div>
</body>
<script type="text/javascript">
var app = angular.module('myApp', ['ui.bootstrap']);

app.controller('PageCtrl', ['$scope', 'filterFilter', '$http', function ($scope, filterFilter, $http) {
	var id = document.getElementById("ids").innerText;
	$scope.DealerId = id;
	//var custTotal = 0;
	$http.get("http://localhost:8083/deal/dealers/"+$scope.DealerId+"").then(function(data, status, headers, config) {
		$scope.items = data.data;
		console.log($scope.items.firmSellBill);
		$scope.getTotalAmount = function(){
			  var total = 0;
			  angular.forEach($scope.items.firmSellBill, function(value,key){
			    total += parseFloat(value.totalAmount);
			  })
			  return total;
			} 
		$scope.getTotalPaidAmount = function(){
			  var total = 0;
			  angular.forEach($scope.items.firmSellBill, function(value,key){
			    total += parseFloat(value.paidAmount);
			  })
			  return total;
			}
		$scope.getTotalDueAmount = function(){
			  var total = 0;
			  angular.forEach($scope.items.firmSellBill, function(value,key){
			    total += parseFloat(value.dueAmount);
			  })
			  return total;
			}
		 $scope.getTotalPayAmount($scope.getTotalDueAmount());
		
		
	});
	
	
	var x = null;
	var id = document.getElementById("ids").innerText;
	$scope.DealerId = id;
	 $http.get("http://localhost:8083/creditDealerAmo/getDealerAmo/"+$scope.DealerId+"").then(function(data, status, headers, config) {
		$scope.itemsCredit = data.data;
		$scope.getTotalCreditAmount = function(){
			  var total = 0;
			  angular.forEach($scope.itemsCredit, function(value,key){
			    total += parseFloat(value.creditAmount);
			  });
			  return total;
			}
		 $scope.getCreditAmount($scope.getTotalCreditAmount());
		 
		});
	  $http.get("http://localhost:8083/firm/dealers/getStock/"+$scope.DealerId+"/Cement").then(function(data, status, headers, config) {
		  $scope.itemStock = data.data;
		  $scope.getTotalAvgPrice = function(){
			  $scope.itemStock.avgPr
		 /*  var total = 0;
		  var num = 0;
		  var avgPrice = 0;
		  var i=1;
		  angular.forEach($scope.itemStock, function(value,key){
			 
				  total += parseFloat(value.price);
				  num =  i++;
				  console.log(num);
				  avgPrice = total/num;
			 
		  }); */
		  return  $scope.itemStock.avgPr;
		} 
	$scope.getTotalStock = function(){
		  /* var total = 0;
		  angular.forEach($scope.itemStock, function(value,key){
			  total += parseFloat(value.qty);
			  }); */
		 
		  return $scope.itemStock.intQtSum;
		} 
	  }); 
	 
    $scope.getCreditAmount = function(x){
		 $scope.cr = x;
		 }
    $scope.getTotalPayAmount = function(x){
		 $scope.ta = x;
		 }
	$scope.getTotalPayOutAmount = function(){
			return  $scope.ta-$scope.cr;
	}
	  $scope.getPayOutStatus = function(){
		   if($scope.ta>$scope.cr){
			 var u = "Unpaid"; 
			 return u;
		 }
		 if($scope.ta==$scope.cr){
			 var p = "Paid"; 
			 return p;
		 } 
		 if($scope.ta<$scope.cr){
			 var o = "Over Paid"; 
			 return o;
		 } 
		
	}  
	 
	
	
	 
}]);
</script>
</html>